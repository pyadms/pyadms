
language: cpp

matrix:
  include:
  - os: osx
    osx_image: xcode14.2
  - os: linux
    dist: focal
    services: docker
    arch: amd64
  - os: linux
    dist: focal
    services: docker
    arch: arm64

addons:
  homebrew:
    update: false

#https://github.com/travis-ci/travis-ci/issues/6893
if: tag IS present

#https://docs.travis-ci.com/user/customizing-the-build/#git-clone-depth
git:
  depth: 3
  submodules: false

#before_install:

#install:


script:
  - if [ "$TRAVIS_OS_NAME" == "linux" ]; then
      bash ./scripts/build_docker_manylinux2014.sh;
    fi
  - if [ "$TRAVIS_OS_NAME" == "osx" ]; then
      bash ./scripts/build_macos.sh;
    fi

#before_deploy:

deploy:
  provider: releases
  api_key:
    secure: "i4qAqZ4aBIsHXcfsA/TjZhCbfBaireyu7DTXaIzs+mkn6nVwicy1WkeDhQ9ZdDVAVzjXhTQ2mbaY0oniUdkaqgE5udnngK3klcePHYXVMXjbRvS9w/EP2r7oZQ7mZw8PjRUB+J1+9jMjUh7qJlXVAnb9bA4u4SpMpfjK5SZj1JYBjMxeIy3S3naQ4cK81ryEy4mhcCm1OtKr48JhlMnUWcJpe0qTwk3LJ2UeuLzjElM5featl2lx8QV/wbxlAUxUawyE2wgiZ9TYWqgeAjz9exleYTToCY3CBXO7xpw7+T2w4FPK3ZxQHgBcLEACmhyaGs1x6CGqflF+Cc5l1ne6gyMLwx3D1yas6J+RLzZgnnhg/xTDDsryRFK8FtuDm+QM3qSxPhXy8Vt78fiB5fNz1imYHh12uPOZ3r8Dt1uk5GAHwVUj0XAjvi69g7iDrzOULdbXHAG68FuePYV9qeXvzreXyLUvlqHZLhe5wIQP2I02s44hj3JZm/+VPk6PwcrW3sh7D6FS/hQ5izo9kkzb3hsN+sBYGqslQTLnbUhd1LnLFC5y51XiQHnQHH7ZP0n/Em5xdZvodgMtk2QX4FJV8H/t4ZKUCnZBEGFw7bZ/p+aIYVCUPiqG2iYNDzDy0RSUJjrOAX8WxhPjpnlpHLoTL4ED+FHrxUhfBXDBVgiDhEc="
  file_glob: true
  file:
    - "*.whl"
  skip_cleanup: true
  prerelease: false
  draft:      true
  # fix issue with multiple deployments https://github.com/travis-ci/travis-ci/issues/6132
  tag_name: $TRAVIS_TAG
  on:
    repo: pyadms/pyadms
    tags: true


